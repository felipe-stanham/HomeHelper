# P-001: HomeHelper System

## Project Overview
**Goal**: Create a unified home automation platform for Raspberry Pi 5 (8GB RAM) that manages multiple independent applications through a single web dashboard.

**Appetite**: 6-8 weeks for MVP (Main App + sample apps provided by user)

**Tech Stack**: FastAPI + Bootstrap 5 + Redis + systemd + Python 3.9+

**Target**: Raspberry Pi 5 with 8GB RAM running Raspberry Pi OS (Debian-based)

## Architecture Summary
- **Main Application**: FastAPI backend with web dashboard
- **App Manager**: Auto-discovery and registry management  
- **Service Manager**: systemd integration for background services
- **UI Manager**: On-demand Streamlit app management with TTL
- **Redis Message Bus**: Inter-app communication
- **UI Proxy**: Service app REST API rendering in modals

## App Types
1. **Service Apps**: Long-running background services with REST APIs
2. **Streamlit Apps**: On-demand interactive UIs with TTL management

## Shared Resources
- **Data Directory**: `/opt/homehelper/data/` - Each app has its own subdirectory
- **Logs Directory**: `/opt/homehelper/logs/` - Each app has its own subdirectory, no standard format

## Scopes and Tasks

### Scope 1: Core Infrastructure
**Goal**: Establish foundation components and basic FastAPI application

- [ ] Project structure setup (`/opt/homehelper/` layout)
- [ ] Configuration management system (JSON config file)
- [ ] Redis integration and message bus client
- [ ] System monitoring utilities (CPU, memory, disk, temperature)
- [ ] Basic FastAPI application skeleton with health endpoint
- [ ] Unit testing framework setup (pytest)
- [ ] Shared logging utilities (per-app subdirectories)

### Scope 2: App Management System  
**Goal**: Auto-discovery, registry, and app lifecycle management

- [ ] App discovery and manifest parsing (`homehelper.json`)
- [ ] In-memory app registry with persistence
- [ ] Dynamic port management and assignment (8100-8199 range)
- [ ] Python dependency installation system (`requirements.txt`)
- [ ] App validation and error handling
- [ ] Setup command execution during installation
- [ ] Registry API endpoints for dashboard consumption

### Scope 3: Service Management
**Goal**: systemd integration and service lifecycle control

- [ ] systemd service template generation
- [ ] Service lifecycle management (start/stop/restart/status)
- [ ] Health check polling system (configurable intervals)
- [ ] Process monitoring and metrics collection
- [ ] Service status tracking in registry
- [ ] Error recovery and restart policies
- [ ] Log access via journalctl integration

### Scope 4: Web Dashboard
**Goal**: Bootstrap 5 responsive web interface

- [ ] Bootstrap 5 responsive layout foundation
- [ ] System status overview page (hardware metrics, Redis status)
- [ ] App status grid with card-based display
- [ ] Manual refresh functionality (no auto-updates)
- [ ] Recent activity/events display from Redis
- [ ] App detail views with metrics and controls
- [ ] Log viewer interface with pagination
- [ ] Status indicators with color coding (‚úÖüü°‚ùå)

### Scope 5: UI Integration
**Goal**: Service app REST API rendering and Streamlit modal integration

- [ ] Service app `/ui` endpoint discovery and parsing
- [ ] Dynamic REST API rendering (tables, forms, images)
- [ ] Field type handling (img_*, date_*, mermaid_*, arrays, objects)
- [ ] Modal overlay system for service app UIs
- [ ] Streamlit app modal integration with iFrame
- [ ] TTL-based Streamlit process management
- [ ] Process cleanup and resource management
- [ ] Error handling for failed app launches

### Scope 6: Sample Applications Integration
**Goal**: Integration testing with user-provided sample apps

- [ ] Sample service app integration testing
- [ ] Sample Streamlit app integration testing  
- [ ] End-to-end workflow validation
- [ ] Documentation for app developers
- [ ] Troubleshooting guides
- [ ] Performance testing on Raspberry Pi 5

### Scope 7: System Integration
**Goal**: Production deployment and system services

- [ ] Main application systemd service configuration
- [ ] Deployment scripts for Raspberry Pi 5
- [ ] File system permissions and security setup
- [ ] System startup and dependency management
- [ ] Configuration file templates
- [ ] Installation and setup documentation
- [ ] Backup and recovery procedures

## Next Steps
1. **Start with Scope 1**: Core Infrastructure development
2. **Unit Testing**: Implement pytest from the beginning
3. **Playwright Testing**: Add after core functionality is complete
4. **UI Enhancements**: Drag & Drop and Dark Mode are valuable but not needed initially

## Success Criteria
- [ ] Main app auto-discovers apps in `./apps/` directory
- [ ] Service apps start/stop via systemd integration
- [ ] Health monitoring dashboard shows real-time status
- [ ] Streamlit apps launch on-demand with TTL cleanup
- [ ] Sample apps (provided by user) integrate successfully
- [ ] Zero-configuration deployment on Raspberry Pi 5
- [ ] Apps can be developed and tested independently
- [ ] System handles 10-20 concurrent apps efficiently

## Development Notes
- **Manual Refresh Pattern**: No auto-updates to reduce Pi resource usage
- **App Independence**: Each app completely independent with own dependencies
- **Centralized Shared Resources**: Data and logs directories shared but organized per-app
- **Modal UI Strategy**: Both Streamlit apps and service UIs render in modals
- **Target Hardware**: Optimized for Raspberry Pi 5 with 8GB RAM
